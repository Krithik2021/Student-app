- name: Deploy the latest war file to apache tomcat
  hosts: deploy
  become: true
  vars:
    - destination_location: "/opt/tomcat/webapps/"
    - buildartifact_location: "{{ lookup('env','WORKSPACE') }}"
  tasks:
    - debug: var={{ buildartifact_location }}
    - name: Copy file with owner and permissions
      copy:
        src: "{{ item }}"
        dest: "{{ destination_location }}"
        owner: devops
        group: devops
        mode: u+rwx,g+rwx,o-rwx
        with_fileglob:
          - "{{ buildartifact_location }}/targets/*.war"
